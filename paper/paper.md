---
title: 'alignparse: A Python package for aligning and parsing long-read sequencing data'
tags:
  - Python
  - PacBio
  - genomics
  - sequencing
  - deep mutational scanning
  - viral genomics
authors:
  - name: Katharine H.D. Crawford
    orcid: 0000-0002-6223-4019
    affiliation: "1, 2"
  - name: Jesse D. Bloom
    orcid: 0000-0003-1267-3408
    affiliation: "1, 3"
affiliations:
  - name: Basic Sciences and Computational Biology, Fred Hutchinson Cancer Research Center, Seattle, Washington, USA
    index: 1 
  - name: Department of Genome Sciences and Medical Scientist Training Program, University of Washington, Seattle, Washington, USA
    index: 2
  - name: Howard Hughes Medical Institute, Seattle, Washington, USA
    index: 3
date: 18 November 2019
bibliography: paper.bib


# Summary & Purpose

Advances in sequencing technology have recently allowed long-read sequencing to become more widely available to genomics researchers. Although traditionally used for genome assembly, long-read sequencing is now fast enough and cheap enough that it has become feasible to do at scale. Scientists can now use long-read sequencing technologies (like PacBio circular consensus sequencing [@Rhoads:2015]) to deep sequence amplicons. This is useful for the in-depth analysis of viral genomes or of libraries containing variants of a single gene. Since long sequencing reads (> 1000 bp) have previously been most widely used for genome assembly, most tools for analyzing long-read sequencing data are not optimized for the analysis of data from deep sequencing individual amplicons. 

`alignparse` provides a tool for parsing complex sets of features from long sequences that map to known amplicons. It provides researchers a flexible tool for aligning long-read sequencing data to user-specified target sequences and for extracting short sequences - corresponding to user-specified features - from these reads for further analyses. `alignparse <https://jbloomlab.github.io/alignparse/>`_ uses `minimap2 <https://github.com/lh3/minimap2>`_ for aligning sequences and takes adavantage of the informative `cs tag <https://lh3.github.io/minimap2/minimap2.html#10>`_ returned from `minimap2 <https://github.com/lh3/minimap2>`_ alignments to parse features from the long-read sequencing data [@Li:2018]. This parsing is all carried out using the `alignparse.targets <https://jbloomlab.github.io/alignparse/alignparse.targets.html>`_ submodule. 

Further analysis of these features is facilitated by the `alignparse.consensus <https://jbloomlab.github.io/alignparse/alignparse.consensus.html>`_ module that provides tools for grouping reads by shared barcodes, determining consensus sequences for barcoded reads, and further processing mutation information for downstream analyses. Such downstream analyses can be highly customized by the user as the output from `alignparse` is in an intuitive data frame format that can be easily used as input for additional analyses. Thus, `alignparse` provides a flexible and useful tool designed specifically for the initial processing of long-read sequencing data from the deep sequencing of known amplicons. 

As long-read sequencing continues to be applied to areas outside of genome assembly, our analysis tools also need to adapt. `alignparse` provides an important tool specifically for analyzing data that comes from the application of long-read sequencing technology to the deep sequencing of pre-defined amplicons that contain complex sets of sequence features to be parsed out for further analyses. 

# Audience

`alignparse` is designed to be used by genomics researchers analyzing long-read sequencing data that maps to pre-defined amplicons. Researchers using long-read sequencing to sequence viral genomes or libraries of variants of single genes for deep mutational scanning will find this tool particularly useful for extracting information from their sequencing reads. Nonetheless, any scientists with long-read sequencing data where each read fully maps to a pre-defined amplicon and from which they would like to extract information about pre-defined sequence features, will find this tool useful for the analysis of such features.

# Uses & Examples 

The flexibility built into `alignparse` allows researchers from many areas of genomics to use this tool to analyze long-read sequencing data from known amplicons. Below are two known use cases:

## Sequencing deep mutational scanning libraries

Long-read sequencing of mutant libraries has allowed researchers conducing deep mutational scanning experiments to link all of the mutations in a variant with a unique molecular barcode [@Matreyek:2018]. This has facilitated the study of the effects of genetic variants on gene function by improving the data generated by deep mutational scanning experiments. In analyzing their data, the Shendure lab wrote `custom Python scripts <https://github.com/shendurelab/AssemblyByPacBio>`_ that are rather specific for their use case and construct design. The `alignparse` package can be used to parse long read sequences for analyzing deep mutational scanning libraries like those in @Matreyek:2018, with much more flexibility than previously available scripts. In particular, the ability to easily define any number of sequence features is very useful for customizing sequence analysis.

Currently, `alignparse` is being used to analyze deep mutational scanning libraries in the Bloom lab, including the RecA deep mutational scanning library in `this <https://jbloomlab.github.io/alignparse/recA_DMS.html>`_ example.

## Single-cell viral sequencing

Given their small size, several viral genomes can be sequenced in full using long-read sequencing technology. Indeed, for influenza virus, each of its eight gene segments can be sequenced as a single long-read sequencing amplicon. Using long-read sequencing in conjunction with single cell technologies (such as 10x Chromium), it is possible to barcode single flu virions and sequence the entire genome of a virus that enters a single cell. In order to analyze these viral sequences, the viral genomic sequences and associated mutations, must be parsed in conjunction with cell-specific barcodes and additional sequence features introduced to ensure accurate variant calling. Such experiments and analyses have been carried out for influenza virus, resulting in expanding our understanding of influenza infection heterogeneity [@Russell:2019]. These analyses were initially carried out with project-specific python scripts. However, as seen in the `Single-cell virus sequencing <https://jbloomlab.github.io/alignparse/flu_virus_seq_example.html>`_ example, this data can be readily analyzed using `alignparse`. 


The flexibility of the `alignparse` package to be used to analyze long-read sequencing data from deep mutational scanning to single-cell virology experiments helps show the broad utility of this package. With the increasing availability of long-read sequencing technologies, we imagine the use cases for this package will grow to include other instances of deep sequencing long amplicons. `alignparse` will also hopefully increase the reproducibility of analyzing such experiments by reducing the current reliance on project-specific scripts and providing researchers an actively-maintained, publically available tool for the initial parsing of amplicon-based long-read sequencing data.


# Acknowledgements

We would like to thank members of the Bloom lab for helpful discussions and beta testing.

# References

